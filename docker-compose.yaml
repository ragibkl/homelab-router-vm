version: '3'

services:
  router:
    build: ./router
    container_name: router
    network_mode: host
    cap_add:
      - NET_ADMIN
      - NET_RAW
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.forwarding=1
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  dnsmasq:
    image: jpillora/dnsmasq
    container_name: dnsmasq
    network_mode: host
    cap_add:
      - NET_ADMIN
    volumes:
      - ./dnsmasq/dnsmasq.conf:/etc/dnsmasq.conf:ro
    depends_on:
      - router
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Optional: WireGuard VPN (uncomment when ready to test)
  # wireguard:
  #   image: linuxserver/wireguard
  #   container_name: wireguard
  #   network_mode: host
  #   cap_add:
  #     - NET_ADMIN
  #     - SYS_MODULE
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=Asia/Kuala_Lumpur
  #     - SERVERURL=auto  # or your public IP/domain
  #     - SERVERPORT=51820
  #     - PEERS=laptop,phone
  #     - PEERDNS=192.168.100.1
  #     - INTERNAL_SUBNET=10.13.13.0/24
  #     - ALLOWEDIPS=192.168.100.0/24
  #   volumes:
  #     - ./wireguard:/config
  #   ports:
  #     - 51820:51820/udp
  #   restart: unless-stopped
